var htmlElement=document.getElementsByTagName('html')[0];var prjCode=htmlElement.getAttribute('data-project');var envMappings={db:'prod',dbrc:'rc',dbtest:'test',dbdev:'dev',dbdev2:'dev',};var subDomain=location.host.split('.')[0];elasticApm.init({serviceName:[envMappings[subDomain],prjCode==='cga'?'cngbdb':prjCode,'fe'].join('_'),serverUrl:location.origin+'/apm/',environment:envMappings[subDomain],});;var cookieText='isLocalStorageAccountValid=1';if(document.cookie.indexOf(cookieText)<0){cookieText+='; path=/';cookieText+='; domain=.'+location.hostname.split('.').slice(1).join('.');document.cookie=cookieText;};var localStorageAccount=localStorage.getItem('account');var anonymousAccount={isAuthenticated:false,displayUsername:'',role:'',status:{hasEmail:null,hasPhone:null,hasPassword:null},refreshedAt:new Date().getTime()};if(localStorageAccount){var account=JSON.parse(localStorageAccount);}else{var account=anonymousAccount;};var localStorageAccountDom=$('#LocalStorageAccountInfo');var isAuthenticated=localStorageAccountDom.attr('data-authenticated')==='True';if(isAuthenticated){var currentAccount={isAuthenticated:true,displayUsername:localStorageAccountDom.attr('data-username'),role:localStorageAccountDom.attr('data-type-name'),status:{hasEmail:localStorageAccountDom.attr('data-has-email')==='True',hasPhone:localStorageAccountDom.attr('data-has-phone')!=='0',hasPassword:localStorageAccountDom.attr('data-has-password')==='True'},refreshedAt:new Date().getTime()};if(account.isAuthenticated===false||account.displayUsername!==localStorageAccountDom.attr('data-username')){currentAccount.isModified=true;};localStorage.setItem('account',JSON.stringify(currentAccount));}else{if(account.isAuthenticated===true){anonymousAccount.isModified=true;};localStorage.setItem('account',JSON.stringify(anonymousAccount));};$.ajaxSetup({complete:function(){var account=JSON.parse(localStorage.getItem('account'));account.refreshedAt=new Date().getTime();localStorage.setItem('account',JSON.stringify(account));},});localStorageAccountDom.remove();;'use strict';var dc_lang=$('html').attr('lang').slice(0,2);var dc_csrf=$('html').attr('data-csrf');var dc_project=$('html').attr('data-project');var i18n_text={};var _i=function(text_code_name){if(i18n_text.hasOwnProperty(text_code_name)){return i18n_text[text_code_name][dc_lang];}else{console.log('Global variable `i18n_text` does not has key: '+text_code_name+'.');return'null';};};;var scrolltotop={setting:{startline:100,scrollto:0,scrollduration:1000,fadeduration:[500,100]},controlHTML:'',controlattrs:{offsetx:5,offsety:5},anchorkeyword:'#top',state:{isvisible:false,shouldvisible:false},scrollup:function(){if(!this.cssfixedsupport)
this.$control.css({opacity:0})
var dest=isNaN(this.setting.scrollto)?this.setting.scrollto:parseInt(this.setting.scrollto)
if(typeof dest=="string"&&jQuery('#'+dest).length==1)
dest=jQuery('#'+dest).offset().top
else
dest=0
this.$body.animate({scrollTop:dest},this.setting.scrollduration);},keepfixed:function(){var $window=jQuery(window)
var controlx=$window.scrollLeft()+$window.width()-this.$control.width()-this.controlattrs.offsetx
var controly=$window.scrollTop()+$window.height()-this.$control.height()-this.controlattrs.offsety
this.$control.css({left:controlx+'px',top:controly+'px'})},togglecontrol:function(){var scrolltop=jQuery(window).scrollTop()
if(!this.cssfixedsupport)
this.keepfixed()
this.state.shouldvisible=(scrolltop>=this.setting.startline)?true:false
if(this.state.shouldvisible&&!this.state.isvisible){this.$control.stop().animate({opacity:1},this.setting.fadeduration[0])
this.state.isvisible=true}
else if(this.state.shouldvisible==false&&this.state.isvisible){this.$control.stop().animate({opacity:0},this.setting.fadeduration[1])
this.state.isvisible=false}},init:function(){jQuery(document).ready(function($){var mainobj=scrolltotop
var iebrws=document.all
mainobj.cssfixedsupport=!iebrws||iebrws&&document.compatMode=="CSS1Compat"&&window.XMLHttpRequest
mainobj.$body=(window.opera)?(document.compatMode=="CSS1Compat"?$('html'):$('body')):$('html,body')
mainobj.$control=$('<div id="topcontrol">'+mainobj.controlHTML+'</div>').css({position:mainobj.cssfixedsupport?'fixed':'absolute',bottom:mainobj.controlattrs.offsety,right:mainobj.controlattrs.offsetx,opacity:0,cursor:'pointer'}).attr({title:'Scroll Back to Top'}).click(function(){mainobj.scrollup();return false}).appendTo('body')
if(document.all&&!window.XMLHttpRequest&&mainobj.$control.text()!='')
mainobj.$control.css({width:mainobj.$control.width()})
mainobj.togglecontrol()
$('a[href="'+mainobj.anchorkeyword+'"]').click(function(){mainobj.scrollup()
return false})
$(window).bind('scroll resize',function(e){mainobj.togglecontrol()})})}}
scrolltotop.init();scrolltotop.controlattrs={offsetx:10,offsety:10};var adjustPaddingButtom=function(){$('.content').css({'padding-bottom':$('#page-footer').height()+'px'});};adjustPaddingButtom();$(window).on('resize',function(event){adjustPaddingButtom();});i18n_text.decimal={en:'',zh:''};i18n_text.emptyTable={en:'No data available in table.',zh:'表格没有数据。'};i18n_text.info={en:'_START_ to _END_ of _TOTAL_ entries',zh:'第_START_到_END_条，总共_TOTAL_条数据'};i18n_text.infoEmpty={en:'No entries',zh:'没有数据'};i18n_text.infoFiltered={en:'(filtered from _MAX_ total entries)',zh:'（从_MAX_条数据检索）'};i18n_text.infoPostFix={en:'',zh:''};i18n_text.thousands={en:',',zh:','};i18n_text.lengthMenu={en:'Show _MENU_ entries',zh:'每页 _MENU_ 条数据'};i18n_text.loadingRecords={en:'Loading...',zh:'加载中...'};i18n_text.processing={en:'<div>Processing...</div>',zh:'<div>加载中...</div>'};i18n_text.search={en:'',zh:''};i18n_text.zeroRecords={en:'No matching records found',zh:'没有匹配的数据'};i18n_text.first={en:'First',zh:'首页'};i18n_text.last={en:'Last',zh:'末页'};i18n_text.next={en:'Next',zh:'下一页'};i18n_text.previous={en:'Previous',zh:'上一页'};i18n_text.sortAscending={en:'',zh:''};i18n_text.sortDescending={en:'',zh:''};i18n_text.filter_datatable={en:'Filter the table.',zh:'检索表格数据。',};i18n_text.go={en:'Go',zh:'前往'};i18n_text.invalid_page={en:'Invalid page number.',zh:'无效的页码。'};;var map_loaded=false;$(document).ready(function(){if($('#home-banner').length==0&&$('#common-banner').length==0){$('.container.content').css('margin-top','115px');};var not_viewed_jobs_count=0;var get_not_viewed_jobs=function(){$.getJSON({url:$('#not_viewed_jobs').attr('data-api'),success:function(response){var refresh=true;if(response.code==0){if(response.data.length==0){$('#not_viewed_jobs').hide();}else{$('#not_viewed_jobs').css('display','inline-block');$('#not_viewed_jobs > span').html(response.data.length);var items=[];for(var i in response.data){items.push($('<p></p>').html('<a href="'+response.data[i].url+'" target="_blank" data-job-code="'+response.data[i].job_code+'">'+'<i class="fa fa-caret-right"></i> '+
response.data[i].job_code+'</a>'));};$('#not_viewed_jobs_list').empty().append(items);};}else{if(response.code==2){if(response.error.code=='unauthenticated'){refresh=false;};};};if(refresh){setTimeout(get_not_viewed_jobs,10000);};},error:function(){setTimeout(get_not_viewed_jobs,10000);}});};get_not_viewed_jobs();$('#not_viewed_jobs_list').on('click',function(event){var target=$(event.target);if(event.target.tagName=='A'){not_viewed_jobs_count--;if(not_viewed_jobs_count<=0){$('#not_viewed_jobs').hide();}else{$('#not_viewed_jobs > span').html(not_viewed_jobs_count);target.parent().remove();};};});});;$(window).on('beforeunload',function(e){(e||window.event).returnValue=null;return null;});$.fn.dataTable.ext.errMode=function(settings,techNote,messages){};var BLASTControl=function(options){this.options=options;this.init();};BLASTControl.prototype={listen_update:function(){var self=this;for(var i=0;i<this.options.fields.length;i++){var j=i;this.options.fields[i].source_dom.on('change '+self.options.fields[i].source_value,this.options.fields[i],function(event){if($(event.target).val()===event.data.source_value){if(event.data.hasOwnProperty('values')){event.data.target_dom.find('option').each(function(){if(event.data.values.indexOf($(this).attr('value').toString())>=0){$(this).prop('selected',$(this).attr('value').toString()===event.data.value).prop('disabled',false).css('color','#555');}else{$(this).prop('selected',false).prop('disabled',true).css('color','#ccc');};});}else{event.data.target_dom.val(event.data.value);};event.data.target_dom.trigger('change');if(event.data.hasOwnProperty('callback')){event.data.callback();};};});};},init:function(){this.listen_update();delete this.listen_update;var self=this;this.options.new_window.on('change',function(event){if(self.options.new_window.val()=='yes'){self.options.form_dom.attr('target','_blank');}else{self.options.form_dom.removeAttr('target');};});this.options.new_window.trigger('change');if(this.options.hasOwnProperty('current')){this.options.current.trigger(this.options.current.val());};}};window.i18n_text.db_list_failed={zh:'加载数据库列表失败。',en:'Failed to get/render the database list.'};window.i18n_text.required_db={en:'Please filter and select at least one database.',zh:'请筛选并选中至少一个数据库。'};window.i18n_text.required_query_loc_from={en:'The from index field is required.',zh:'请填写起点坐标。'};window.i18n_text.required_query_loc_to={en:'The to index field is required.',zh:'请填写终点坐标。'};window.i18n_text.invalid_query_loc_from={en:'Invalid from index. Must be an integer.',zh:'无效的起点坐标。必须是一个整数。'};window.i18n_text.invalid_query_loc_to={en:'Invalid to index. Must be an integer.',zh:'无效的终点坐标。必须是一个整数。'};window.i18n_text.invalid_query_loc={en:'To index must be equal to or larger than 1. And from index must be smaller than to index.',zh:'起点坐标必须等于或大于1，且起点坐标必须小于终点坐标。'};window.i18n_text.required_result_format={en:'Please select at least one result format.',zh:'请选择至少一个结果格式。'};window.i18n_text.required_query={en:'Please provide sequences in by text or file.',zh:'请输入序列文本或选择序列文件。'};window.i18n_text.title_too_long={en:'Title can only contains up to 64 characters.',zh:'任务描述只允许至多64个字符。'};window.i18n_text.query_file_too_large={en:'The query file size must smaller than 5MB.',zh:'查询文件大小必须小于5MB。'};window.i18n_text.required_plain_text_file={en:'The query file must be a plain text file.',zh:'查询文件必须是纯文本文件。'};window.i18n_text.filter_datatable={en:'Filter the database name and code.',zh:'检索数据库名称和编号。'};window.i18n_text.lengthMenu={en:'You can chose one or more databases to search. But it may need more time to wait.',zh:'你可以选择一个或多个数据库进行搜索，但可能需要等待更长时间。'};window.i18n_text.no_organisms={en:'No organisms.',zh:'没有选中的物种。'};window.i18n_text.loading={en:'Loading...',zh:'加载中。。。'};window.i18n_text.load_failed={en:'Failed to load.',zh:'加载失败。'};window.i18n_text.no_matches={en:'No matches.',zh:'没有匹配结果。'};window.i18n_text.hot={en:'HOT',zh:'热门'};window.i18n_text.not_allowed_mix_db={en:'The database is another format version. Please deselect the selected items, and then you can choose this category database.',zh:'此数据库为另一格式版本, 请取消已选项，再进行此类别数据库选择。'};var selected_db_version='';var DBControl=function(options){console.log(this)
this.options=options;this.db_values=[];this.taxids_values=[];this.negative_taxids_values=[];this.organism_draw=0;this.top3_dbs=this.options.result_dom.attr('data-top3-db').split(',');this.init();};DBControl.prototype={render_db_target:function(data){console.log(data)
selected_db_version=data[0].version;var items=[];var projects=this.options.project_dom.val();projects=projects==''?[]:projects.split(',');for(var i=0;i<data.length;i++){var item=$('<span></span>').html(data[i].name+' ['+data[i].project+']['+data[i].version+'] ').addClass('blast_db_badge').append($('<i></i>').attr('data-type','data').attr('data-db-name',data[i].db_name).attr('data-project',data[i].project).addClass('fa fa-times'));items.push(item);if(projects.indexOf(data[i].project)<0){projects.push(data[i].project);};};this.options.display_dom.append(items);this.options.project_dom.val(projects.sort().join(','));},get_db_list:function(data){var self=this;$.getJSON({url:self.options.db_list_api,data:data,success:function(response){if(response.code===0){self.render_db_target(response.data);}else{$(self.display_dom.selector+'_message').show().html(response.error.content);};},error:function(){$(self.display_dom.selector+'_message').show().html(_i('db_list_failed'));}});},render_organism_target:function(data,negative_marker){var items=[];for(var i in data){var item=$('<span></span>').html(data[i].name+' (taxid:'+data[i].taxid+') ').addClass('blast_organism_badge').append($('<i></i>').attr('data-type','data').attr('data-taxid',data[i].taxid).addClass('fa fa-times'));items.push(item);};if(negative_marker==true){if(this.options.taxids_display_dom.find('.no_organisms').length>0){this.options.taxids_display_dom.find('.no_organisms').remove();};this.options.taxids_display_dom.append(items);}else{if(this.options.negative_taxids_display_dom.find('.no_organisms').length>0){this.options.negative_taxids_display_dom.find('.no_organisms').remove();};this.options.negative_taxids_display_dom.append(items);};},get_organism_list:function(data,negative_marker){var self=this;$.getJSON({url:self.options.organism_list_api,data:data,success:function(response){if(response.code===0){self.render_organism_target(response.data,negative_marker);};},error:function(){}});},listen:function(){var self=this;self.options.version_nav_dom.find('a').on('click',function(event){var version_value=$(event.target).attr('aria-controls');self.options.version_dom.val(version_value);self.table.draw();if(version_value=='v5'){$('#id_organism_container').show();}else{$('#id_organism_container').hide();};});$("input[name='cluster_type']").on("click",function(){self.table.draw();self.options.display_dom.html('')
self.db_values=[]})
self.table=self.options.result_dom.DataTable({dom:'r<".datatable-top-bar"lf>t<".datatable-custom-paging"<p<".datatable-page-input">>>',serverSide:true,processing:true,lengthChange:true,paging:true,info:false,searching:true,ordering:false,scrollY:450,scrollCollapse:true,ajax:{data:function(rawdata){var data={};data.draw=rawdata.draw;data.program=self.options.program_dom.val();data.version=self.options.version_dom.val();data.keywords=rawdata.search.value;console.log($("input[name='cluster_type']:checked"))
data.cluster_type=$("input[name='cluster_type']:checked").length!=0?$("input[name='cluster_type']:checked").val():1;return data;},url:self.options.db_search_api,dataSrc:function(response){for(var i=0;i<response.data.length;i++){var checkbox='<div class="checkbox '+(selected_db_version==''||selected_db_version==response.data[i][4]?'':'disabled')+'">'+'<input type="checkbox" '+'id="'+response.data[i][0]+'" '+'data-db-name="'+response.data[i][0]+'" '+'data-name="'+response.data[i][1]+'" '+'data-code="'+response.data[i][2]+'" '+'data-project="'+response.data[i][3]+'" '+'data-version="'+response.data[i][4]+'" '+
(self.db_values.indexOf(response.data[i][0])>=0?'checked="checked "':'')+
(selected_db_version==''||selected_db_version==response.data[i][4]?'':'disabled="disabled"')+'>'+'<label for="'+response.data[i][0]+'" data-toggle="popover" data-trigger="hover" data-container="body" data-content="'+
_i('not_allowed_mix_db')+'" data-placement="right"></label>'+'</div>';if(self.top3_dbs.indexOf(response.data[i][0])>=0){response.data[i][1]=response.data[i][1]+'<span class="badge">'+
_i('hot')+'</span>';};response.data[i][0]=checkbox;};return response.data;}},language:{emptyTable:_i('emptyTable'),zeroRecords:_i('zeroRecords'),processing:_i('processing'),lengthMenu:_i('lengthMenu'),search:_i('search')},drawCallback:function(settings){if(settings.json.code==2){$('table.dataTable tbody tr > td').html(settings.json.error.content);};$('table.dataTable .checkbox.disabled > label').popover();},initComplete:function(settings,response){console.log(response)
var name=GetQueryValue('project')
console.log(first_page)
for(var i=0;i<response.data.length;i++){if(first_page&&name==response.data[i][2]){first_page=false
document.getElementById(response.data[i][2]).click();}}
var table_wrapper_dom=$(settings.nTableWrapper);var table=$(settings.nTable).DataTable();var filter_form_group=$('<div></div>').addClass('input-group');var filter_input=table_wrapper_dom.find('.dataTables_filter input').clone().addClass('form-control').attr({'maxlength':'128','placeholder':_i('filter_datatable')}).off('keyup keypress input cut paste').on('keypress',function(event){if(event.keyCode===13){event.preventDefault();var value=filter_input.val().replace(/^\s+/,'').replace(/\s+$/,'');filter_input.val(value);table.search(value).draw();};}).appendTo(filter_form_group);var filter_btn_container=$('<div></div>').addClass('input-group-btn').appendTo(filter_form_group);var filter_btn=$('<button></button>').html('<span class="fa fas fa-search"></span>').addClass('btn').attr('type','button').on('click',function(event){var value=filter_input.val().replace(/^\s+/,'').replace(/\s+$/,'');filter_input.val(value);table.search(value).draw();}).appendTo(filter_btn_container);table_wrapper_dom.find('.dataTables_filter input').replaceWith(filter_form_group);}});this.options.result_dom.on('click',function(event){if(event.target.tagName==='INPUT'){var target=$(event.target);var db_name=target.attr('data-db-name');if(target.prop('checked')){self.render_db_target([{db_name:db_name,project:target.attr('data-project'),version:target.attr('data-version'),name:target.attr('data-name')}]);var index=self.db_values.indexOf(db_name);if(index<0){self.db_values.push(db_name);self.options.save_dom.val(self.db_values.join(',')).trigger('change');};}else{var index=self.db_values.indexOf(db_name);if(index>=0){self.db_values.splice(index,1);};self.options.save_dom.val(self.db_values.join(',')).trigger('change');self.options.display_dom.find('i[data-db-name="'+db_name+'"]').parent().remove();var projects=[];var selected_dbs=self.options.display_dom.find('i');for(var i=0;i<selected_dbs.length;i++){var project=$(selected_dbs[i]).attr('data-project');if(projects.indexOf(project)<0){projects.push(project);};};self.options.project_dom.val(projects.join(','));};};});this.options.display_dom.on('click',function(event){var target=$(event.target);if(event.target.tagName==='I'&&target.attr('data-type')==='data'){var db_name=target.attr('data-db-name');var index=self.db_values.indexOf(db_name);if(index>=0){self.db_values.splice(index,1);};self.options.save_dom.val(self.db_values.join(',')).trigger('change');target.parent().remove();self.options.result_dom.find('input#'+db_name).prop('checked',false);var projects=[];var selected_dbs=self.options.display_dom.find('i');for(var i=0;i<selected_dbs.length;i++){var project=$(selected_dbs[i]).attr('data-project');if(projects.indexOf(project)<0){projects.push(project);};};self.options.project_dom.val(projects.join(','));};});this.options.save_dom.on('change',function(event){if($(event.target).val()==''){selected_db_version='';self.table.draw();$('#id_organism').prop('disabled',false);}else{if(selected_db_version=='v5'){$('#id_organism').prop('disabled',false);}else{self.options.taxids_dom.val('');self.options.taxids_display_dom.find('span').remove();self.options.taxids_display_dom.append($('<span></span>').addClass('no_organisms').html(_i('no_organisms')));self.options.negative_taxids_dom.val('');self.options.negative_taxids_display_dom.find('span').remove();self.options.negative_taxids_display_dom.append($('<span></span>').addClass('no_organisms').html(_i('no_organisms')));self.options.organism_dom.val('').prop('disabled',true);};};});this.options.organism_dom.on('keyup',function(event){if($('#id_organism_field').hasClass('open')==false){$('#id_organism_field').addClass('open');};var value=self.options.organism_dom.val();if(event.keyCode==13){event.preventDefault();}else{if(value==''){self.options.taxid_suggestion_dom.empty();}else if(value.length>=3||(value.length<3&&/^\d{1,2}$/.test(value)==true)){self.options.taxid_suggestion_dom.html('<li><a rel="nofollow" href="#">'+_i('no_matches')+'</a></li>');self.organism_draw+=1;$.getJSON({url:self.options.organism_search_api,data:{draw:self.organism_draw,search:value.replace(/^\s+|\s+$/,''),projects:self.options.project_dom.val(),length:self.taxids_values.length+self.negative_taxids_values.length+50},success:function(response){if(response.draw==self.organism_draw){if(response.code==0){if(response.data.length==0){self.options.taxid_suggestion_dom.html('<li><a rel="nofollow" href="#">'+_i('no_matches')+'</a></li>');}else{var items=[];for(var i in response.data){if(self.negative_taxids_values.indexOf(response.data[i].taxid)<0&&self.taxids_values.indexOf(response.data[i].taxid)<0){var item=$('<li></li>');item.html('<a rel="nofollow" href="#" data-type="data" data-name="'+
response.data[i].name+'" data-taxid="'+response.data[i].taxid+'">'+response.data[i].name+' (taxid:'+
response.data[i].taxid+')</a>');items.push(item);};};if(items.length==0){self.options.taxid_suggestion_dom.html('<li><a rel="nofollow" href="#">'+
_i('no_matches')+'</a></li>');}else{self.options.taxid_suggestion_dom.empty().append(items);};};}else{self.options.taxid_suggestion_dom.html('<li><a rel="nofollow" href="#">'+_i('load_failed')+'</a></li>');};};},error:function(){self.options.taxid_suggestion_dom.html('<li><a rel="nofollow" href="#">'+_i('load_failed')+'</a></li>');}});};};});this.options.taxid_suggestion_dom.on('click',function(event){var target=$(event.target);if(event.target.tagName=='A'){event.preventDefault();if(target.attr('data-type')==='data'){var data=[{taxid:target.attr('data-taxid'),name:target.attr('data-name')}];var negative_marker=!!$('#id_organism_exclude').val();self.render_organism_target(data,negative_marker);if(negative_marker==true){self.taxids_values.push(target.attr('data-taxid'));self.options.taxids_dom.val(self.taxids_values.join(','));self.taxids_values.push(target.attr('data-taxid'));}else{self.negative_taxids_values.push(target.attr('data-taxid'));self.options.negative_taxids_dom.val(self.negative_taxids_values.join(','));self.negative_taxids_values.push(target.attr('data-taxid'));};self.options.organism_dom.val('');self.options.taxid_suggestion_dom.empty();};};});this.options.taxids_display_dom.on('click',function(event){var target=$(event.target);if(event.target.tagName=='I'&&target.attr('data-type')=='data'){var taxid=target.attr('data-taxid');var index=self.taxids_values.indexOf(taxid);if(index>=0){self.taxids_values.splice(index,1);};self.options.taxids_dom.val(self.taxids_values.join(','));target.parent().remove();if(self.options.taxids_display_dom.find('span').length==0){self.options.taxids_display_dom.append($('<span></span>').addClass('no_organisms').html(_i('no_organisms')));};};});this.options.negative_taxids_display_dom.on('click',function(event){var target=$(event.target);if(event.target.tagName=='I'&&target.attr('data-type')=='data'){var taxid=target.attr('data-taxid');var index=self.negative_taxids_values.indexOf(taxid);if(index>=0){self.negative_taxids_values.splice(index,1);};self.options.negative_taxids_dom.val(self.negative_taxids_values.join(','));target.parent().remove();if(self.options.negative_taxids_display_dom.find('span').length==0){self.options.negative_taxids_display_dom.append($('<span></span>').addClass('no_organisms').html(_i('no_organisms')));};};});},init:function(){var self=this;console.log(222)
this.listen();if(!!this.options.save_dom.val()){this.db_values=this.options.save_dom.val().split(',');this.get_db_list({program:self.options.program_dom.val(),db_names:self.options.save_dom.val()});};if(!!this.options.taxids_dom.val()){this.taxids_values=this.options.taxids_dom.val().split(',');this.get_organism_list({'taxids':this.options.taxids_dom.val()},true);};if(!!this.options.negative_taxids_dom.val()){this.negative_taxids_values=this.options.negative_taxids_dom.val().split(',');this.get_organism_list({'taxids':this.options.negative_taxids_dom.val()},false);};}};function GetQueryValue(queryName){var query=decodeURI(window.location.search.substring(1));var vars=query.split("&");for(var i=0;i<vars.length;i++){var pair=vars[i].split("=");if(pair[0]==queryName){return pair[1];}}
return null;}
var first_page=true
$(document).ready(function(){$('i[data-toggle="popover"]').popover({trigger:'hover'});if($('#id_program').val()==='blastn'){var source_dom=$('#id_task');var blastListen=new BLASTControl({form_dom:$('#blast-form'),new_window:$('#new_window'),fields:[{source_dom:source_dom,source_value:'megablast',value:'28',values:['16','20','24','28','32','48','64','128','256'],target_dom:$('#id_word_size')},{source_dom:source_dom,source_value:'dc-megablast',value:'11',values:['11','12'],target_dom:$('#id_word_size')},{source_dom:source_dom,source_value:'blastn',value:'11',values:['7','11','15'],target_dom:$('#id_word_size')},{source_dom:source_dom,source_value:'megablast',value:'1,-2',values:['1,-2','1,-3','1,-4','2,-3','4,-5','1,-1'],target_dom:$('#id_map_scores')},{source_dom:source_dom,source_value:'dc-megablast',value:'2,-3',values:['1,-2','1,-3','1,-4','2,-3','4,-5','1,-1'],target_dom:$('#id_map_scores')},{source_dom:source_dom,source_value:'blastn',value:'2,-3',values:['1,-2','1,-3','1,-4','2,-3','4,-5','1,-1'],target_dom:$('#id_map_scores')},{source_dom:$('#id_map_scores'),source_value:'1,-2',value:'5 2',values:['5 2','2 2','1 2','0 2','3 1','2 1','1 1'],target_dom:$('#id_gap_cost'),callback:function(){if($('#id_task').val()=='megablast'){$('#id_gap_cost > option[value="0 0"]').prop('selected',true).prop('disabled',false).css('color','#555');};}},{source_dom:$('#id_map_scores'),source_value:'1,-3',value:'5 2',values:['5 2','2 2','1 2','0 2','2 1','1 1'],target_dom:$('#id_gap_cost'),callback:function(){if($('#id_task').val()=='megablast'){$('#id_gap_cost > option[value="0 0"]').prop('selected',true).prop('disabled',false).css('color','#555');};}},{source_dom:$('#id_map_scores'),source_value:'1,-4',value:'5 2',values:['5 2','1 2','0 2','2 1','1 1'],target_dom:$('#id_gap_cost'),callback:function(){if($('#id_task').val()=='megablast'){$('#id_gap_cost > option[value="0 0"]').prop('selected',true).prop('disabled',false).css('color','#555');};}},{source_dom:$('#id_map_scores'),source_value:'2,-3',value:'5 2',values:['4 4','2 4','0 4','3 3','6 2','5 2','4 2','2 2'],target_dom:$('#id_gap_cost'),callback:function(){if($('#id_task').val()=='megablast'){$('#id_gap_cost > option[value="0 0"]').prop('selected',true).prop('disabled',false).css('color','#555');};}},{source_dom:$('#id_map_scores'),source_value:'4,-5',value:'5 2',values:['12 8','6 5','5 5','4 5','3 5'],target_dom:$('#id_gap_cost'),callback:function(){if($('#id_task').val()!='megablast'){$('#id_gap_cost > option[value="12 8"]').prop('selected',true);}else{$('#id_gap_cost > option[value="0 0"]').prop('selected',true).prop('disabled',false).css('color','#555');};}},{source_dom:$('#id_map_scores'),source_value:'1,-1',value:'5 2',values:['5 2','3 2','2 2','1 2','0 2','4 1','3 1','2 1'],target_dom:$('#id_gap_cost')}],current:source_dom});$('#id_task').on('change',function(event){if($('#id_task').val()=='dc-megablast'){$('#id_template_length_field').show();$('#id_template_type_field').show();}else{$('#id_template_length_field').hide();$('#id_template_type_field').hide();};});$('#id_task').trigger('change');}else if($('#id_program').val()==='blastp'||$('#id_program').val()==='blastx'||$('#id_program').val()==='tblastn'){var source_dom=$('#id_matrix');var fields=[{source_dom:source_dom,source_value:'PAM30',value:'9 1',values:['7 2','6 2','5 2','10 1','9 1','8 1','13 3','15 3','14 1','14 2'],target_dom:$('#id_gap_cost')},{source_dom:source_dom,source_value:'PAM70',value:'10 1',values:['8 2','7 2','6 2','11 1','10 1','9 1','12 3','11 2'],target_dom:$('#id_gap_cost')},{source_dom:source_dom,source_value:'PAM250',value:'14 2',values:['15 3','14 3','13 3','12 3','11 3','17 2','16 2','15 2','14 2','13 2','21 1','20 1','19 1','18 1','17 1'],target_dom:$('#id_gap_cost')},{source_dom:source_dom,source_value:'BLOSUM80',value:'10 1',values:['8 2','7 2','6 2','11 1','10 1','9 1'],target_dom:$('#id_gap_cost')},{source_dom:source_dom,source_value:'BLOSUM62',value:'11 1',values:['11 2','10 2','9 2','8 2','7 2','6 2','13 1','12 1','11 1','10 1','9 1'],target_dom:$('#id_gap_cost')},{source_dom:source_dom,source_value:'BLOSUM45',value:'15 2',values:['13 3','12 3','11 3','10 3','15 2','14 2','13 2','12 2','19 1','18 1','17 1','16 1'],target_dom:$('#id_gap_cost')},{source_dom:source_dom,source_value:'BLOSUM50',value:'13 2',values:['13 3','12 3','11 3','10 3','9 3','16 2','15 2','14 2','13 2','12 2','19 1','18 1','17 1','16 1','15 1'],target_dom:$('#id_gap_cost')},{source_dom:source_dom,source_value:'BLOSUM90',value:'10 1',values:['9 2','8 2','7 2','6 2','11 1','10 1','9 1'],target_dom:$('#id_gap_cost')}];if($('#id_program').val()==='blastp'){fields.push({source_dom:$('#id_task'),source_value:'blastp',value:'BLOSUM62',values:['BLOSUM62','BLOSUM45','BLOSUM50','BLOSUM80','BLOSUM90','PAM30','PAM70','PAM250'],target_dom:$('#id_matrix')});fields.push({source_dom:$('#id_task'),source_value:'blastp-fast',value:'BLOSUM62',values:['BLOSUM62','BLOSUM45','BLOSUM50','BLOSUM80','BLOSUM90','PAM30','PAM70','PAM250'],target_dom:$('#id_matrix')});fields.push({source_dom:$('#id_task'),source_value:'blastp-short',value:'PAM30',values:['BLOSUM62','BLOSUM45','BLOSUM50','BLOSUM80','BLOSUM90','PAM30','PAM70','PAM250'],target_dom:$('#id_matrix')});fields.push({source_dom:$('#id_task'),source_value:'blastp',value:'6',values:['2','3','6'],target_dom:$('#id_word_size')});fields.push({source_dom:$('#id_task'),source_value:'blastp-fast',value:'6',values:['2','3','6'],target_dom:$('#id_word_size')});fields.push({source_dom:$('#id_task'),source_value:'blastp-short',value:'2',values:['2','3','6'],target_dom:$('#id_word_size')});fields.push({source_dom:$('#id_task'),source_value:'blastp',value:'2',values:['0','1','2','3'],target_dom:$('#id_comp_based_stats')});fields.push({source_dom:$('#id_task'),source_value:'blastp-fast',value:'2',values:['0','1','2','3'],target_dom:$('#id_comp_based_stats')});fields.push({source_dom:$('#id_task'),source_value:'blastp-short',value:'0',values:['0','1','2','3'],target_dom:$('#id_comp_based_stats')});};var blastListen=new BLASTControl({form_dom:$('#blast-form'),new_window:$('#new_window'),fields:fields,current:source_dom});}else if($('#id_program').val()==='tblastx'){var blastListen=new BLASTControl({form_dom:$('#blast-form'),new_window:$('#new_window'),fields:[]});};$('#id_version').val($('#id_version_toggler li.active > a').attr('aria-controls'));var dbListen=new DBControl({program_dom:$('#id_program'),version_nav_dom:$('#id_version_toggler'),version_dom:$('#id_version'),result_dom:$('#blast_db_table'),save_dom:$('#id_db'),display_dom:$('#id_db_list'),organism_dom:$('#id_organism'),taxid_suggestion_dom:$('#id_taxid_suggestion_list'),taxids_dom:$('#id_taxids'),taxids_display_dom:$('#id_taxids_list'),negative_taxids_dom:$('#id_negative_taxids'),negative_taxids_display_dom:$('#id_negative_taxids_list'),project_dom:$('#id_project'),db_list_api:$('#blast_db_table').attr('data-list-api'),db_search_api:$('#blast_db_table').attr('data-search-api'),organism_list_api:$('#id_organism').attr('data-list-api'),organism_search_api:$('#id_organism').attr('data-search-api')});$('#id_title').on('keypress',function(event){if(event.keyCode===13){event.preventDefault();};});$('#id_query_loc_from').on('keypress',function(event){if(event.keyCode===13){event.preventDefault();};});$('#id_query_loc_to').on('keypress',function(event){if(event.keyCode===13){event.preventDefault();};});var changed_field=0;var special_fields=['word_size','gap_cost','map_scores','matrix','comp_based_stats'];(function(){var fields=$('#option-block .form-control');for(var i=0;i<fields.length;i++){var field=$(fields[i]);var default_value=field.attr('data-initial');if(special_fields.indexOf(field.attr('name'))>=0){if($('#id_program').val()=='blastn'&&$('#id_task').val()!='megablast'){switch(field.attr('name')){case'word_size':var default_value='11';break;case'gap_cost':var default_value='5 2';break;case'map_scores':var default_value='2,-3';break;};};};if(field.val()!=default_value){changed_field++;};if(changed_field>0){$('#restore_param_btn').show();};};})();$('#option-block .form-control').on('change',function(event){var field=$(event.target);var field_name=field.attr('name');var default_value=field.attr('data-initial');if(special_fields.indexOf(field_name)>=0){if($('#id_program').val()=='blastn'&&$('#id_task').val()!='megablast'){switch(field.attr('name')){case'word_size':var default_value='11';break;case'gap_cost':var default_value='5 2';break;case'map_scores':var default_value='2,-3';break;};}else if($('#id_program').val()=='blastp'&&$('#id_task').val()=='blastp-short'){switch(field.attr('name')){case'word_size':var default_value='2';break;case'matrix':var default_value='PAM30';break;case'gap_cost':var default_value='9 1';break;case'comp_based_stats':var default_value='0';break;};};};if(field.val()!=default_value){changed_field++;$('#restore_param_btn').show();}else{if(changed_field!=0)changed_field--;if(changed_field==0)$('#restore_param_btn').hide();};});$('#restore_param_btn').on('click',function(event){event.preventDefault();var fields=$('#option-block .form-control');for(var i=0;i<fields.length;i++){var field=$(fields[i])
if(special_fields.indexOf(field.attr('name'))>=0){if($('#id_program').val()=='blastn'&&$('#id_task').val()!='megablast'){switch(field.attr('name')){case'word_size':var default_value='11';break;case'gap_cost':var default_value='5 2';break;case'map_scores':var default_value='2,-3';break;};field.val(default_value);}else if($('#id_program').val()=='blastp'&&$('#id_task').val()=='blastp-short'){switch(field.attr('name')){case'word_size':var default_value='2';break;case'matrix':var default_value='PAM30';break;case'gap_cost':var default_value='9 1';break;case'comp_based_stats':var default_value='0';break;};field.val(default_value);}else{field.val(field.attr('data-initial'));};}else{field.val(field.attr('data-initial'));};};changed_field=0;$(event.target).hide();});(function(){$('#id_result_format_field input').on('click',function(event){var value=$('#id_result_format').val()
var result_format=value==''?[]:value.split(',');var target=$(event.target);var target_id=target.attr('id');var index=result_format.indexOf(target_id);if(target.prop('checked')){if(index<0){result_format.push(target_id);};}else{if(index>=0){result_format.splice(index,1);};};$('#id_result_format').val(result_format.join(','));});var location_values=$('#id_query_loc').val();if(location_values){var location_list=location_values.split('-');if(location_list.length==2){$('#id_query_loc_from').val(location_list[0]);$('#id_query_loc_to').val(location_list[1]);};};var format_values=$('#id_result_format').val();if(format_values){var format_list=format_values.split(',');for(var i=0;i<format_list.length;i++){$('#id_result_format_field input#'+format_list[i]).prop('checked',true);};};})();$('#blast-form-btn').removeClass('disabled').prop('disabled',false).popover();if($('#id_new_window').prop('checked')==true){$('#blast-form').attr('target','_blank');}else{$('#blast-form').removeAttr('target');};$('#id_new_window').on('change',function(event){if($(this).prop('checked')==true){$('#blast-form').attr('target','_blank');}else{$('#blast-form').removeAttr('target');};});$('#blast-form').on('submit',function(event){$(window).off('beforeunload');$('#blast-form-btn').addClass('disabled').prop('disabled',true);var has_error=false;var go_to='';if($('#id_title').val().length<=64){$('#id_title_message').hide();}else{has_error=true;$('#id_title_message').html(_i('title_too_long')).show();go_to='common-banner';};var file_field=$('#id_file_query');if($('#id_text_query').val()==''&&file_field.val()==''){has_error=true;$('#id_file_query_message').html(_i('required_query')).show();go_to='common-banner';}else{if(file_field.val()!=''){if(file_field[0].files.length==1&&file_field[0].files[0].size<=1024*1024*5){if(file_field[0].files[0].type=='text/plain'||file_field[0].files[0].type==''){$('#id_file_query_message').hide();}else{has_error=true;$('#id_file_query_message').html(_i('required_plain_text_file')).show();go_to='common-banner';};}else{has_error=true;$('#id_file_query_message').html(_i('query_file_too_large')).show();go_to='common-banner';};}else{$('#id_file_query_message').hide();};};var query_loc_from=$('#id_query_loc_from').val();var query_loc_to=$('#id_query_loc_to').val();$('#id_query_loc').val([query_loc_from,query_loc_to].join('-'));if(query_loc_from==''&&query_loc_to!=''){has_error=true;$('#id_query_loc_message').html(_i('required_query_loc_from')).show();if(go_to==''){go_to='common-banner';};}else if(query_loc_from!=''&&query_loc_to==''){has_error=true;$('#id_query_loc_message').html(_i('required_query_loc_to')).show();if(go_to==''){go_to='common-banner';};}else if(query_loc_from==''&&query_loc_to==''){$('#id_query_loc_message').hide();$('#id_query_loc').val('');}else{if(/^\d+$/.test(query_loc_from)==false){has_error=true;$('#id_query_loc_message').html(_i('invalid_query_loc_from')).show();if(go_to==''){go_to='common-banner';};}else if(/^\d+$/.test(query_loc_to)==false){has_error=true;$('#id_query_loc_message').html(_i('invalid_query_loc_to')).show();if(go_to==''){go_to='common-banner';};}else{query_loc_from=parseInt(query_loc_from);query_loc_to=parseInt(query_loc_to);if(query_loc_from>0&&query_loc_from<query_loc_to){$('#id_query_loc_message').hide();}else{has_error=true;$('#id_query_loc_message').html(_i('invalid_query_loc')).show();if(go_to==''){go_to='common-banner';};};};};if($('#id_db').val()==''){has_error=true;$('#id_db_message').html(_i('required_db')).show();if(go_to==''){go_to='id_db_field';};}else{$('#id_db_message').hide();};if($('#id_result_format').val()==''){has_error=true;$('#id_result_format_message').html(_i('required_result_format')).show();if(go_to==''){go_to='id_title_field';};}else{$('#id_result_format_message').hide();};if(go_to){window.location.hash='#'+go_to;};if(has_error||$('#id_new_window:checked').length==1){$('#blast-form-btn').removeClass('disabled').prop('disabled',false);$(window).on('beforeunload',function(e){(e||window.event).returnValue=null;return null;});};return!has_error;});});;if(window.location.hostname==='db.cngb.org'){var ga_code=$('html').attr('data-ga');window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());if(ga_code){gtag('config',ga_code);};if(ga_code!=='G-T45MLZBW6Q'){gtag('config','G-T45MLZBW6Q');};};;